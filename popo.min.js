/*!
 * Popo JS - v0.7.7 - 11/2/2013
 *
 * Copyright (c) 2013 Niklas Rämö
 * Released under the MIT license
 */
(function(E,n){var H="popo",h=E.document,g=h.documentElement,v=h.body,y=E.Math,x=y.abs,l="left",k="right",f="top",s="bottom",t="center",G="function",r="number",F="getBoundingClientRect",m="clientWidth",K="clientHeight",e=Object.prototype.toString,w={nw:[k,s,l,f],n:[t,s,t,f],ne:[l,s,k,f],e:[l,t,k,t],se:[l,f,k,s],s:[t,f,t,s],sw:[k,f,l,s],w:[k,t,l,t],center:[t,t,t,t]};function b(M){return typeof String.prototype.trim===G?M.trim():M.replace(/^\s+|\s+$/g,"")}function D(M){var O={},N,P;for(N=0;N<M.length;N++){for(P in M[N]){O[P]=M[N][P]}}return O}function I(M){return M===E?(g[m]||v[m]):M===h?(y.max(g[m],g.offsetWidth,g.scrollWidth,v.scrollWidth,v.offsetWidth)):(M[F]().width||M.offsetWidth)}function z(M){return M===E?(g[K]||v[K]):M===h?(y.max(g[K],g.offsetHeight,g.scrollHeight,v.scrollHeight,v.offsetHeight)):(M[F]().height||M.offsetHeight)}function c(){return typeof E.pageXOffset===r?E.pageXOffset:g.scrollLeft||v.scrollLeft}function p(){return typeof E.pageYOffset===r?E.pageYOffset:g.scrollTop||v.scrollTop}function o(N,Q){var P=0,M=0,O;if(N===E){P=c();M=p()}else{if(N!==h){O=N[F]();if(typeof O!=="undefined"){P=O.left+c();M=O.top+p();if(Q===true){P+=N.clientLeft;M+=N.clientTop}}}}return{left:P,top:M}}function J(M){return M.style.position?(M.style.position):M.currentStyle?(M.currentStyle.position):h.defaultView&&h.defaultView.getComputedStyle?(h.defaultView.getComputedStyle(M,null).getPropertyValue("position")):("static")}function i(M){var N;if(M===g){N=h}else{if(M===v){N=g}else{N=M.offsetParent;while(N!==g&&J(N)==="static"){N=N===v?g:N.offsetParent}}}return N}function u(Q){var N=J(Q),T,P,S,O,R,M;N==="fixed"?(T={left:0,top:0}):N==="absolute"?(T=o(i(Q),true)):N!=="relative"?(T=o(Q)):(P=Q.style,S=P.left,O=P.right,R=P.top,M=P.bottom,P.left=P.right=P.top=P.bottom="auto",T=o(Q),P.left=S,P.right=O,P.top=R,P.bottom=M);return T}function q(P,R,N){var Q=P.className.split(" "),M=Q.length,O;for(O=0;O<M;O++){if(Q[O].substring(0,R.length)===R){Q.splice(O,1)}}if(N!==""){Q.push(N)}P.className=Q.join(" ")}function C(O){var N=typeof O==="string"&&O.length!==0?O.split(" "):"",M=N.length;if(M>0&&M<5){return{left:N[0],top:M>1?N[1]:N[0],right:M>2?N[2]:N[0],bottom:M===4?N[3]:M===1?N[0]:N[1]}}else{return null}}function j(R){var O={x:0,y:0},Q=1000000,S=R.split(","),M=S.length,V,U,N,T,P;for(P=0;P<M;P++){V=b(S[P]).split(" ");U=V.length;if(U===2&&V[0].indexOf("deg")!==-1){N=parseFloat(V[0]);T=parseFloat(V[1]);if(typeof N===r&&typeof T===r&&T!==0){O.x+=y.round((y.cos(N*(y.PI/180))*T)*Q)/Q;O.y+=y.round((y.sin(N*(y.PI/180))*T)*Q)/Q}}else{if(U===1||U===2){O.x+=parseFloat(V[0]);O.y+=U===1?parseFloat(V[0]):parseFloat(V[1])}}}return O}function L(N){var M=e.call(N)==="[object Object]"?D([E[H].defaults,N]):D([E[H].defaults]),O;for(O in M){if(typeof M[O]==="string"){M[O]=b(M[O])}}if(M.setClass){M.cls=H+"-"+M.position.replace(/\s+/g,"-")}M.position=M.position.split(" ");M.position=M.position.length===1?w[M.position[0]].slice(0):M.position;M.offset=j(M.offset);if(M.container!==null&&typeof M.onCollision!==G){M.onCollision=C(M.onCollision)}return M}function d(Q,P,O,N){var M={};M[l+l]=M[f+f]=P;M[l+t]=M[f+t]=P+(O/2);M[l+k]=M[f+s]=P+O;M[t+l]=M[t+f]=P-(N/2);M[t+t]=P+(O/2)-(N/2);M[t+k]=M[t+s]=P+O-(N/2);M[k+l]=M[s+f]=P-N;M[k+t]=M[s+t]=P-N+(O/2);M[k+k]=M[s+s]=P-N+O;return M[Q]}function A(O,M,Q,N,S,R,P){return{left:Q.left+N.left-P.left,right:(P.left+S)-(Q.left+N.left+O),top:Q.top+N.top-P.top,bottom:(P.top+R)-(Q.top+N.top+M)}}function a(Y,U,Q,P,Z,aa,S,T,M){var X="push",W="push!",O=[[l,k],[f,s]],V,N,R;for(R=0;R<2;R++){V=O[R][0];N=O[R][1];if((M[V]===X||M[V]===W)&&(M[N]===X||M[N]===W)&&(T[V]<0||T[N]<0)){if(T[V]>T[N]){if(x(T[N])<=x(T[V])){Q[V]-=x(T[N])}else{Q[V]-=((x(T[V])+x(T[N]))/2)}}else{if(T[V]<T[N]){if(x(T[V])<=x(T[N])){Q[V]+=x(T[V])}else{Q[V]+=((x(T[V])+x(T[N]))/2)}}}T=A(Y,U,Q,P,Z,aa,S);if(M[V]===W&&T[V]<0){Q[V]+=x(T[V])}else{if(M[N]===W&&T[N]<0){Q[V]-=x(T[N])}}}else{if((M[V]===W||M[V]===X)&&T[V]<0){Q[V]+=x(T[V])}else{if((M[N]===W||M[N]===X)&&T[N]<0){Q[V]-=x(T[N])}}}}}function B(M,W,T){var N=L(T),X=I(W),V=z(W),O=u(W),Q,Z=N.base,P,R,aa,ac,Y,ab,S,U;e.call(N.base)==="[object Array]"?(P=R=0,aa=o(Z[2]||E),aa.left+=Z[0],aa.top+=Z[1]):(P=I(Z),R=z(Z),aa=o(Z));if(N.setClass&&(" "+W.className+" ").indexOf(" "+N.cls+" ")===-1){q(W,H,N.cls)}Q={left:d(N.position[0]+N.position[2],aa.left+N.offset.x-O.left,P,X),top:d(N.position[1]+N.position[3],aa.top+N.offset.y-O.top,R,V)};if(N.container!==null){ac=N.container;Y=I(ac);ab=z(ac);S=o(ac);U=A(X,V,Q,O,Y,ab,S);if(typeof N.onCollision===G){N.onCollision(Q,W,Z,ac)}else{if(N.onCollision!==null){a(X,V,Q,O,Y,ab,S,U,N.onCollision)}}}if(M==="set"){W.style.left=Q.left+"px";W.style.top=Q.top+"px"}else{return Q}}E[H]={set:function(M,N){B("set",M,N);return this},get:function(M,N){return B("get",M,N)},defaults:{position:t,offset:"0",base:E,setClass:false,container:null,onCollision:"push"}}})(window);