/*! Popo - v0.9.0dev - 18/5/2013
 * https://github.com/niklasramo/popo
 * Copyright (c) 2012, 2013 Niklas Rämö <inramo@gmail.com>
 * Released under the MIT license */
(function(k,h){var c="popo",E=k.document,j=k.parseFloat,e=k.Math,g=e.abs,y=({}).toString,z="left",C="right",D="top",r="bottom",d="center",u="width",f="height",q="function",v="string",p="documentElement",b="body",l="getBoundingClientRect";function i(F){return typeof F===v?(F.trim?F.trim():F.replace(/^\s+|\s+$/g,"")):F}function w(J){var H={},F=J.length,G,I;for(G=0;G<F;G++){for(I in J[G]){H[I]=J[G][I]}}return H}function s(F,G){return k.getComputedStyle?(k.getComputedStyle(F,null).getPropertyValue(G)):F.currentStyle?(F.currentStyle[G]):(null)}function n(F){var G=F.offsetParent,H="style" in F&&s(F,"position");if(H=="fixed"){G=k}else{if(H=="absolute"){G=F===E[b]?E[p]:G||E;while("style" in G&&s(G,"position")=="static"){G=G===E[b]?E[p]:G.offsetParent||E}}}return G}function m(F){return F===k?(E[p].clientWidth):F===E||F===E[p]?(e.max(E[p].scrollWidth,E[b].scrollWidth)):(F[l]&&u in F[l]()?F[l]()[u]:F.offsetWidth)}function a(F){return F===k?(E[p].clientHeight):F===E||F===E[p]?(e.max(E[p].scrollHeight,E[b].scrollHeight)):(F[l]&&f in F[l]()?F[l]()[f]:F.offsetHeight)}function x(G,M){var I=0,F=0,J=k.pageXOffset||E[p].scrollLeft||E[b].scrollLeft||0,L=k.pageYOffset||E[p].scrollTop||E[b].scrollTop||0,H=G,K;if(G===k){I=J;F=L}else{if(G!==E&&G!==E[p]){K=G[l]&&G[l]();if(K&&z in K&&D in K){I+=K[z]+J-(E[p].clientLeft||0);F+=K[D]+L-(E[p].clientTop||0)}else{while(H){I+=H===k?J:H.offsetLeft||0;F+=H===k?L:H.offsetTop||0;H=n(H)}}if(M){I+=G.clientLeft||0;F+=G.clientTop||0}}}return{left:I,top:F}}function o(P){var H,F,N,G,I,O,K,J,M,L;P=y.call(P)==="[object Object]"?w([k[c].defaults,P]):w([k[c].defaults]);for(F in P){P[F]=i(typeof P[F]!==q?P[F]:F=="onCollision"?P[F]:P[F]());if(F=="position"){P[F]=P[F].split(" ")}if(F=="offset"){N={x:0,y:0};G=typeof P[F]===v?P[F].split(","):[];I=1000000;for(H=G.length;H--;){O=i(G[H]).split(" ");K=j(O[0])||0;J=O.length>1?j(O[1])||0:K;if(O[0].indexOf("deg")>-1&&O.length>1&&J){N.x+=e.round((e.cos(K*(e.PI/180))*J)*I)/I;N.y+=e.round((e.sin(K*(e.PI/180))*J)*I)/I}else{N.x+=K;N.y+=J}}P[F]=N}if(F=="onCollision"){N=typeof P[F]===q?P[F]:null;if(typeof P[F]===v&&P[F].length>0){M=P[F].split(" ");L=M.length;if(L>0&&L<5){N={left:M[0],top:L>1?M[1]:M[0],right:L>2?M[2]:M[0],bottom:L>3?M[3]:L<2?M[0]:M[1]}}}P[F]=N}}return P}function t(J,I,H,G){var F={};F[z+z]=F[D+D]=I;F[z+d]=F[D+d]=I+(H/2);F[z+C]=F[D+r]=I+H;F[d+z]=F[d+D]=I-(G/2);F[d+d]=I+(H/2)-(G/2);F[d+C]=F[d+r]=I+H-(G/2);F[C+z]=F[r+D]=I-G;F[C+d]=F[r+d]=I-G+(H/2);F[C+C]=F[r+r]=I-G+H;return F[J]}function A(F,R,J){var N=0,O="push",G=O+"!",I=J?D:z,Q=J?r:C,L=F[I],M=F[Q],P=R[I],K=R[Q],H=P+K;if((L==O||L==G)&&(M==O||M==G)&&(P<0||K<0)){if(P<K){N-=H<0?P+g(H/2):P}if(K<P){N+=H<0?K+g(H/2):K}P+=N;K-=N;if(L==G&&M!=G&&P<0){N-=P}if(M==G&&L!=G&&K<0){N+=K}}else{if((L==G||L==O)&&P<0){N-=P}else{if((M==G||M==O)&&K<0){N+=K}}}return N}function B(H,I,K){K=o(typeof I===v?K:I);var T=K.onCollision,N=m(H),O=a(H),J=x(n(H),1),W,P,Q,F=K.base,V,L,U,G=K.container,R,S,M;y.call(F)==="[object Array]"?(V=L=0,U=x(F[2]||k),U[z]+=F[0],U[D]+=F[1]):(V=m(F),L=a(F),U=x(F));Q={left:t(K.position[0]+K.position[2],U[z]+K.offset.x-J[z],V,N),top:t(K.position[1]+K.position[3],U[D]+K.offset.y-J[D],L,O)};if(G){y.call(G)==="[object Array]"?(R=S=0,M=x(G[2]||k),M[z]+=G[0],M[D]+=G[1]):(R=m(G),S=a(G),M=x(G));P={left:Q[z]+J[z]-M[z],right:(M[z]+R)-(Q[z]+J[z]+N),top:Q[D]+J[D]-M[D],bottom:(M[D]+S)-(Q[D]+J[D]+O)};if(typeof T===q){W=x(H);T(Q,P,{target:{element:H,width:N,height:O,offset:W,position:{left:W[z]>J[z]?g(W[z]-J[z]):-g(W[z]-J[z]),top:W[D]>J[D]?g(W[D]-J[D]):-g(W[D]-J[D])}},base:{element:F,width:V,height:L,offset:U},container:{element:G,width:R,height:S,offset:M}})}else{if(T){Q[z]+=A(T,P);Q[D]+=A(T,P,1)}}}if(I==="get"){return Q}else{H.style[z]=Q[z]+"px";H.style[D]=Q[D]+"px";return H}}k[c]=B;k[c].defaults={base:k,position:"center center center center",offset:"0",container:null,onCollision:"none"}})(window);